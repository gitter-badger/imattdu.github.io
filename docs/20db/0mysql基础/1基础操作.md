# sql介绍

## sql分类

SQL语言在功能上主要分为如下3大类:

DDL**(**Data Definition Languages**、数据定义语言)**，这些语句定义了不同的数据库、表、视图、索 引等数据库对象，还可以用来创建、删除、修改数据库和数据表的结构。

主要的语句关键字包括 CREATE 、 DROP 、 ALTER 等。



 DML**(**Data Manipulation Language**、数据操作语言)**，用于添加、删除、更新和查询数据库记 录，并检查数据完整性。

主要的语句关键字包括 INSERT 、 DELETE 、 UPDATE 、 SELECT 等。

SELECT**是**SQL**语言的基础，最为重要。
** DCL**(**Data Control Language**、数据控制语言)**，用于定义数据库、表、字段、用户的访问权限和 安全级别。

主要的语句关键字包括 GRANT 、 REVOKE 、 COMMIT 、 ROLLBACK 、 SAVEPOINT 等。







因为查询语句使用的非常的频繁，所以很多人把查询语句单拎出来一类:DQL(数据查询语言)。

还有单独将 COMMIT 、 ROLLBACK 取出来称为TCL (Transaction Control Language，事务控制语 言)。





## 规范



必须使用英文状态下的半角输入方式 

字符串型和日期时间类型的数据可以使用单引号(' ')表示 

列的别名，尽量使用双引号(" ")，而且不建议省略as





数据库名、表名、表别名、字段名、字段别名等都小写 

SQL 关键字、函数名、绑定变量等都大写





单行注释: #注释文字(MySQL特有的方式) 

单行注释:-- 注释文字(--后面必须包含一个空格。)

 多行注释:/* 注释文字 */







# 基础操作



## 基础查询



```sql
SELECT * FROM `user`;

SELECT `name` 
FROM `user`;

# 别名
SELECT id, `name` as "姓名"
FROM user;


# 去重
select DISTINCT id
from `user`;
```

### 去重

**DISTINCT 其实是对后面所有列名的组合进行去重，你能看到最后的结果是 74 条，因为这 74 个a不同，都有 b 这个属性值。如果你想要看都有哪些不同的a，只需要写 a即可，后面不需要再加其他的列名了。**



### 空值 null



在 MySQL 里面， 空值不等于空字符串。一个空字符串的长度是 0，而一个空值的长度是空。而且，在 MySQL 里面，空值是占用空间的。

所有运算符或列值遇到null值，运算的结果都为null



### 反引号

我们需要保证表中的字段、表名等没有和保留字、数据库系统或常用方法冲突。如果真的相同，请在

SQL语句中使用一对``(着重号)引起来。

### 常数列



```sql
SELECT id, `name`, 'matt'
FROM `user`
```





### desc



```sql
desc user;
```



![](https://raw.githubusercontent.com/imattdu/img/main/img/202204231614478.png)



- Field:表示字段名称。
- Type:表示字段类型，这里 barcode、goodsname 是文本型的，price 是整数类型的。 
- Null:表示该列是否可以存储NULL值。 
- Key:表示该列是否已编制索引。PRI表示该列是表主键的一部分;UNI表示该列是UNIQUE索引的一部分;MUL表示在列中某个给定值允许出现多次。 
- Default:表示该列是否有默认值，如果有，那么值是多少。
- Extra:表示可以获取的与给定列有关的附加信息，例如AUTO_INCREMENT等。









## 运算符



### 算数运算符

```sql
+ - * / % 
```



**在Java中，+的左右两边如果有字符串，那么表示字符串的拼接。但是在MySQL中+只表示数 值相加。如果遇到非数值类型，先尝试转成数值，如果转失败，就按0计算。(补充:MySQL 中字符串拼接要使用字符串函数CONCAT()实现)**





一个数除以整数后，不管是否能除尽，结果都为一个浮点数; 一个数除以另一个数，除不尽时，结果为一个浮点数，并保留到小数点后4位;

在数学运算中，0不能用作除数，在MySQL中，一个数除以0为NULL。





### 比较运算符



```sql
>
>=
<
<=
!=

=

# 不等于
<>
# 安全等于
<=>
```



#### 等号

如果等号两边的值、字符串或表达式都为字符串，则MySQL会按照字符串进行比较，其比较的 是每个字符串中字符的ANSI编码是否相等。

如果等号两边的值都是整数，则MySQL会按照整数来比较两个值的大小。

如果等号两边的值一个是整数，另一个是字符串，则MySQL会将字符串转化为数字进行比较。 

如果等号两边的值、字符串或表达式中有一个为NULL，则比较结果为NULL。





#### null

```sql
SELECT 1 is NULL, 1 is NOT NULL
```



#### least greatest

最小值 最大值

```SQL
SELECT LEAST(1,2), GREATEST(1, 2)
```

参数是整数或者浮点数时，LEAST将返回其中最小的值;当参数为字符串时，返回字 母表中顺序最靠前的字符;当比较值列表中有NULL时，不能判断大小，返回值为NULL。





#### between and



```SQL
# 1 <= id <= 3
SELECT *
FROM `user`
WHERE id BETWEEN 1 AND 3
```



#### in not in

in:在

not in:不在



```sql
SELECT *
FROM `user`
WHERE id in(2, 4)
```



#### like

模糊匹配



```sql
SELECT *
FROM `user`
WHERE `name` like '%m%'
```

“%”:匹配0个或多个字符。

 “_”:只能匹配一个字符。



#### ESCAPE



```sql
SELECT job_id
FROM jobs
WHERE job_id LIKE ‘IT\_%‘;
```

如果使用\表示转义，要省略ESCAPE。如果不是\，则要加上ESCAPE。

```sql
SELECT job_id
FROM jobs
WHERE job_id LIKE ‘IT$_%‘ escape ‘$‘;
```





#### REGEXP运算符



（1）‘^’匹配以该字符后面的字符开头的字符串。 

（2）‘$’匹配以该字符前面的字符结尾的字符串。 

（3）‘.’匹配任何一个单字符。 

（4）“[...]”匹配在方括号内的任何字符。例如，“[abc]”匹配“a”或“b”或“c”。为了命名字符的范围，使用一 个‘-’。“[a-z]”匹配任何字母，而“[0-9]”匹配任何数字。 

（5）‘*’匹配零个或多个在它前面的字符。例如，“x*”匹配任何数量的‘x’字符，“[0-9]*”匹配任何数量的数字， 而“*”匹配任何数量的任何字符。





```sql
 SELECT 'shkstart' REGEXP '^s', 'shkstart' REGEXP 't$', 'shkstart' REGEXP 'hk';
```



```sql
SELECT *
FROM `user`
WHERE `name` REGEXP 'Lo'
```



### 逻辑运算符



and 与

or 或

not 非

xor 异或





### 位运算











| 运算符 |   作用   |
| :----: | :------: |
|   &    |  按位与  |
|   \|   |  按位或  |
|   ^    | 按位异或 |
|   ~    | 按位取反 |
|   >>   |   右移   |
|   <<   |   左移   |









## 排序 分页





### 排序



```sql
select *
from `user`
order by id desc, name desc
```







### 分页

**LIMIT [位置偏移量,] 行数**



从0开始



10：10条记录

0 9

```SQL
select *
from `user`
order by id desc, name desc
LIMIT 0, 10

```



## 多表查询



### 基础

#### 等值连接



```sql
SELECT a.a1, b.b1, b.a1
FROM ABC a, BCD b
WHERE a.a1 = b.a1
```

**多个表中有相同列时，必须在列名之前加上表名前缀。**



#### 非等值连接





```sql
SELECT a.a1, b.b1, b.a1
FROM ABC a, BCD b
WHERE a.a1 > b.a1
```



#### 自连接 非自连接

一张表



俩张及以上的表进行连接



#### 内连接 外连接





**1.内连接就是取交集的部分。**
**2.左连接就是左表全部的数据加上交集的数据。**
**3.右连接就是右表全部的数据加上交集的数据。**
**4.交叉连接就是全都要**



左外连接：左表是主表











### c99







```sql
SELECT a.*
FROM A a INNER JOIN B b
ON a.id = b.id
INNER JOIN C c
ON c.id = b.id
```





```sql
SELECT a.*
FROM A a LEFT OUTER JOIN B b
ON a.id = b.id
```





```SQL
SELECT a.*
FROM A a RIGHT OUTER JOIN B b
ON a.id = b.id
```



**需要注意的是，LEFT JOIN 和 RIGHT JOIN 只存在于 SQL99 及以后的标准中，在 SQL92 中不存在， 只能用 (+) 表示。**







满外连接的结果 = 左右表匹配的数据 + 左表没有匹配到的数据 + 右表没有匹配到的数据。 

SQL99是支持满外连接的。使用FULL JOIN 或 FULL OUTER JOIN来实现。 

需要注意的是，MySQL不支持FULL JOIN，但是可以用 LEFT JOIN UNION RIGHT join代替。









#### union



union:去重 (a, b, ab)

union all:不去重 (a, b, ab, ab)



```sql
select * from a
union
select * from b
```









![](https://raw.githubusercontent.com/imattdu/img/main/img/202204250001072.png)





左中图

```sql
#实现A - A∩B
select 字段列表
from A表 left join B表
on 关联条件
where 从表关联字段 is null and 等其他子句;
```





右中图

```sql
#实现B - A∩B
select 字段列表
from A表 right join B表
on 关联条件
where 从表关联字段 is null and 等其他子句;
```







左下图



```sql
实现查询结果是A∪B
#用左外的A，union 右外的B
select 字段列表
from A表 left join B表
on 关联条件
where 等其他子句
union
select 字段列表
from A表 right join B表
on 关联条件
where 等其他子句;
```









```sql
#实现A∪B - A∩B 或 (A - A∩B) ∪ （B - A∩B）
#使用左外的 (A - A∩B) union 右外的（B - A∩B）
select 字段列表
from A表 left join B表
on 关联条件
where 从表关联字段 is null and 等其他子句
union
select 字段列表
from A表 right join B表
on 关联条件
where 从表关联字段 is null and 等其他子句
```

